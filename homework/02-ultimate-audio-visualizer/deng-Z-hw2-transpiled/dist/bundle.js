(()=>{"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var t,n,r,a,o,i,c,s=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return"rgba(".concat(e,",").concat(t,",").concat(n,",").concat(r,")")},l=function(e,t){return Math.random()*(t-e)+e},u=Object.freeze({gain:5,distortion:0,pan:0,numSamples:256}),h=(new Uint8Array(u.numSamples/2),function(e){for(var t="number"==typeof e?e:50,n=44100,r=new Float32Array(n),a=Math.PI/180,o=0;o<n;o++){var i=2*o/n-1;r[o]=(3+t)*i*20*a/(Math.PI+t*Math.abs(i))}return r}),d=function(e){n.src=e};function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,g(r.key),r)}}function m(e,t,n){return t&&y(e.prototype,t),n&&y(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function g(e){var t=function(e){if("object"!=f(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==f(t)?t:t+""}var p=function(){return m(function e(t){var n=t.x,r=t.y,a=t.color,o=t.radius,i=t.radiusVariance,c=t.arcs,s=t.segments,l=t.segmentJitter,u=t.lineWidth,h=t.dataStart,d=t.dataEnd;v(this,e),this.x=n,this.y=r,this.color=a,this.radius=o,this.radiusVariance=i,this.arcs=c,this.segments=s,this.segmentJitter=l,this.lineWidth=u,this.dataStart=h,this.dataEnd=d},[{key:"update",value:function(e){var t=e.length||0,n=Math.floor(this.dataStart*t),r=Math.round(this.dataEnd*t),a=e.slice(n,r).reduce(function(e,t){return e+t},0)/(r-n);this.radius=a,this.radiusVariance=a,this.arcs=Math.round(a/30),this.segmentJitter=8*(1.3-(this.dataEnd-this.dataStart))}},{key:"updateX",value:function(e){this.x=e}},{key:"draw",value:function(e){e.save();for(var t=1;t<=this.arcs;t++)for(var n=this.randomVec(),r=new b(0,0),a=new b(0,0),o=0;o<this.segments;o++)a=(a=n.scaled(o/this.segments)).addNoise(this.segmentJitter),e.strokeStyle=this.color,e.lineWidth=this.lineWidth,e.globalAlpha=this.radius/255,e.beginPath(),e.moveTo(this.x+r.x,this.y+r.y),e.lineTo(this.x+a.x,this.y+a.y),e.closePath(),e.stroke(),r=a;e.restore()}},{key:"randomVec",value:function(){var e=this.radius+l(-this.radiusVariance,this.radiusVariance);e<0&&(e=0);var t=l(0,2*Math.PI),n=Math.cos(t)*e,r=Math.sin(t)*e;return new b(n,r)}}])}(),b=function(){function e(t,n){v(this,e),this.x=t,this.y=n}return m(e,[{key:"normalized",value:function(){var t=this.length();return new e(this.x/t,this.y/t)}},{key:"length",value:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},{key:"scaled",value:function(t){return new e(this.x*t,this.y*t)}},{key:"addNoise",value:function(t){return new e(this.x+l(-t,t),this.y+l(-t,t))}}])}();function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,q(r.key),r)}}function q(e){var t=function(e){if("object"!=w(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==w(t)?t:t+""}var x,k,M,E,T,P,C=function(){return e=function e(t){var n=t.x,r=t.y,a=t.radius,o=t.dx,i=t.dy,c=t.canvasWidth,s=t.canvasHeight,l=t.color;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=n,this.y=r,this.radius=a,this.dx=o,this.dy=i,this.canvasWidth=c,this.canvasHeight=s,this.color=l},t=[{key:"update",value:function(){(this.x+this.radius>this.canvasWidth||this.x-this.radius<0)&&(this.dx=-this.dx),(this.y+this.radius>this.canvasHeight||this.y-this.radius<0)&&(this.dy=-this.dy),this.x+=this.dx,this.y+=this.dy}},{key:"draw",value:function(e){e.save(),e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore()}}],t&&S(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),A=[],j=["rgba(144, 255, 70, 1)","rgba(255, 171, 81, 1)"],L=["rgba(58, 99, 166, 1)","rgba(88, 66, 184, 1)","rgba(40, 121, 91, 1)"],H=[],W=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.timeDomain?T.getByteTimeDomainData(P):T.getByteFrequencyData(P);var n=t.coilCenter;if(A[0].dataEnd=n,A[1].dataStart=n,x.save(),x.globalAlpha=.1,x.clearRect(0,0,M,E),x.restore(),k.fillStyle="#4b2386ff",k.fillRect(0,0,M,E),t.showGradient&&H.forEach(function(e){e.update(),e.draw(k)}),t.showBars){var r=(M-4*P.length-10)/P.length,a=5+n*P.length*(r+4)/2,o=M-(M-2*a)/2;A[0].updateX(a),A[1].updateX(o),x.save(),x.globalAlpha=.5,x.beginPath();var i=[];x.moveTo(5,E/2-P[0]/2);for(var c=0;c<P.length;c++){var l=5+c*(r+4),u=E/2-P[c]/2;if(i.push([l,E/2+P[c]/2]),c<P.length-1){var h=5+(c+1)*(r+4),d=E/2-P[c+1]/2;0===c&&x.lineTo(l,u);var f=(h+l)/2,v=(d+u)/2;x.quadraticCurveTo(l,u,f,v)}else x.lineTo(l,u)}for(var y=i.length-1;y>0;y--){var m=i[y][0],g=i[y][1];if(y<P.length-1){var p=i[y-1][0],b=i[y-1][1];0===y&&x.lineTo(m,g);var w=(p+m)/2,S=(b+g)/2;x.quadraticCurveTo(m,g,w,S)}else x.lineTo(m,g)}x.closePath();var q=function(t,n,r,a,o,i){var c,s=t.createLinearGradient(0,0,a,0),l=function(t,n){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,n){if(t){if("string"==typeof t)return e(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var a=0,o=function(){};return{s:o,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,i=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw i}}}}(i);try{for(l.s();!(c=l.n()).done;){var u=c.value;s.addColorStop(u.percent,u.color)}}catch(e){l.e(e)}finally{l.f()}return s}(x,0,0,M,0,[{percent:0,color:j[0]},{percent:+n-.05<.01?0:+n-.05,color:j[0]},{percent:+n+.05>.99?.99:+n+.05,color:j[1]},{percent:n,color:j[1]}]);x.fillStyle=q,x.fill(),x.restore()}if(t.showCircles){var C=E/4;x.save(),x.globalAlpha=.5,P.forEach(function(e,t){var n=e/255,r=n*C;x.beginPath(),x.fillStyle=s(58,99,166,.34-n/3),x.arc(M/2,E/2,r,0,2*Math.PI,!1),x.fill(),x.closePath(),x.beginPath(),x.fillStyle=s(88,66,184,.1-n/10),x.arc(M/2,E/2,1.5*r,0,2*Math.PI,!1),x.fill(),x.closePath(),x.save(),x.beginPath(),x.fillStyle=s(40,121,91,.5-n/5),x.arc(M/2,E/2,.5*r,0,2*Math.PI,!1),x.fill(),x.closePath(),x.restore()}),x.restore()}t.showTeslas&&A.forEach(function(e){e.update(P),e.draw(x)})},F={showGradient:!0,showBars:!0,showCircles:!0,showTeslas:!0,timeDomain:!1,coilCenter:.5},B=Object.freeze({sound1:"media/Blessing Song.mp3"}),I=function(e,r){document.querySelector("#fs-button").onclick=function(e){var t;console.log("goFullscreen() called"),(t=r).requestFullscreen?t.requestFullscreen():t.mozRequestFullscreen?t.mozRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()};var a=document.querySelector("#play-button");a.onclick=function(e){console.log("audioCtx.state before = ".concat(t.state)),"suspended"==t.state&&t.resume(),console.log("audioCtx.state after = ".concat(t.state)),"no"==e.target.dataset.playing?(n.play(),e.target.dataset.playing="yes"):(n.pause(),e.target.dataset.playing="no")};var s=document.querySelector("#volume-slider"),l=document.querySelector("#volume-label");s.oninput=function(e){var t;t=+(t=e.target.value),o.gain.value=t,l.innerHTML=Math.round(e.target.value/2*100)},s.dispatchEvent(new Event("input"));var u=document.querySelector("#distortion-slider"),f=document.querySelector("#distortion-label");u.oninput=function(e){var t,n;t=e.target.value,n=h(t=+t),i.curve=n,f.innerHTML=Math.round(e.target.value)},u.dispatchEvent(new Event("input"));var v=document.querySelector("#pan-slider"),y=document.querySelector("#pan-label");v.oninput=function(e){var t;t=+(t=e.target.value),c.pan.value=t,y.innerHTML=e.target.value},v.dispatchEvent(new Event("input"));var m=document.querySelector("#coil-slider"),g=document.querySelector("#coil-label");m.oninput=function(e){F.coilCenter=e.target.value,g.innerHTML=e.target.value},m.dispatchEvent(new Event("input")),document.querySelector("#track-select").onchange=function(e){d(e.target.value),"yes"==a.dataset.playButton&&a.dispatchEvent(new MouseEvent("click"))};var p=document.querySelector("#gradient-cb"),b=document.querySelector("#bars-cb"),w=document.querySelector("#circles-cb"),S=document.querySelector("#tesla-cb"),q=document.querySelector("#domain-type-cb");p.checked=F.showGradient,b.checked=F.showBars,w.checked=F.showCircles,S.checked=F.showTeslas,q.checked=F.timeDomain,p.addEventListener("change",function(e){F.showGradient=!F.showGradient,p.checked=F.showGradient}),b.addEventListener("change",function(e){F.showBars=!F.showBars,b.checked=F.showBars}),w.addEventListener("change",function(e){F.showCircles=!F.showCircles,w.checked=F.showCircles}),S.addEventListener("change",function(e){F.showTeslas=!F.showTeslas,S.checked=F.showTeslas}),q.addEventListener("change",function(e){F.timeDomain=!F.timeDomain,q.checkced=F.timeDomain})},z=function(){setTimeout(function(){z()},1e3/60),W(F)};window.onload=function(){console.log("window.onload called"),function(){var e,s;e=B.sound1,s=window.AudioContext||window.webkitAudioContext,t=new s,n=new Audio,d(e),r=t.createMediaElementSource(n),(a=t.createAnalyser()).fftSize=u.numSamples,(o=t.createGain()).gain.value=u.gain,(i=t.createWaveShaper()).curve=h(u.distortion),i.oversample="4x",(c=t.createStereoPanner()).pan.value=u.pan,r.connect(a).connect(c).connect(o).connect(i).connect(t.destination),console.log("init called"),fetch("data/av-data.json").then(function(e){return e.json()}).then(function(e){var t=document.querySelector("title"),n=document.querySelector("#title");t.innerHTML=e.title,n.innerHTML=e.title;var r=document.querySelector("#track-select"),a=e.audio_files.map(function(e){return'<option value="'.concat(e.filepath,'">').concat(e.metadata.title,"</option>")}).join("\n");r.innerHTML=a,document.querySelector("#instructions").innerHTML=e.instructions}).catch(function(e){return console.log("Warning, error occurred: ".concat(e)),null});var f=document.querySelector("#fg-canvas"),v=document.querySelector("#canvas");I(f,v),function(e,t){x=e.getContext("2d"),M=e.width,E=e.height,T=t,P=new Uint8Array(T.fftSize/2),k=document.querySelector("#bg-canvas").getContext("2d"),A.push(new p({x:200,y:200,color:j[0],radius:200,radiusVariance:100,arcs:10,segments:20,segmentJitter:5,lineWidth:1,dataStart:0,dataEnd:.5}),new p({x:600,y:200,color:j[1],radius:200,radiusVariance:100,arcs:10,segments:20,segmentJitter:5,lineWidth:1,dataStart:.5,dataEnd:1}));for(var n=0;n<20;n++){var r=l(M/15,M/5),a=l(r,M-r),o=l(r,E-r),i=l(-M/1e3,M/1e3),c=l(-E/1e3,E/1e3);H.push(new C({x:a,y:o,radius:r,dx:i,dy:c,canvasWidth:M,canvasHeight:E,color:L[Math.floor(Math.random()*L.length)]}))}}(f,a),z()}()}})();