(()=>{"use strict";var e,t,n,a,r,i,o,s,c=function(e,t,n,a){return void 0===a&&(a=1),"rgba(".concat(e,",").concat(t,",").concat(n,",").concat(a,")")},l=function(e,t){return Math.random()*(t-e)+e};!function(e){e[e.GAIN=5]="GAIN",e[e.DISTORTION=0]="DISTORTION",e[e.PAN=0]="PAN",e[e.NUM_SAMPLES=256]="NUM_SAMPLES"}(e||(e={})),new Uint8Array(e.NUM_SAMPLES/2);var u,h,d,v,f,y,g=function(e){for(var t="number"==typeof e?e:50,n=44100,a=new Float32Array(n),r=Math.PI/180,i=0;i<n;i++){var o=2*i/n-1;a[i]=(3+t)*o*20*r/(Math.PI+t*Math.abs(o))}return a},m=function(e){n.src=e},p=function(){function e(e){this.x=e.x,this.y=e.y,this.color=e.color,this.radius=e.radius,this.radiusVariance=e.radiusVariance,this.arcs=e.arcs,this.segments=e.segments,this.segmentJitter=e.segmentJitter,this.lineWidth=e.lineWidth,this.dataStart=e.dataStart,this.dataEnd=e.dataEnd}return e.prototype.update=function(e){var t=e.length||0,n=Math.floor(this.dataStart*t),a=Math.round(this.dataEnd*t),r=e.slice(n,a).reduce(function(e,t){return e+t},0)/(a-n);this.radius=r,this.radiusVariance=r,this.arcs=Math.round(r/30),this.segmentJitter=8*(1.3-(this.dataEnd-this.dataStart))},e.prototype.updateX=function(e){this.x=e},e.prototype.draw=function(e){e.save();for(var t=1;t<=this.arcs;t++)for(var n=this.randomVec(),a=new S(0,0),r=new S(0,0),i=0;i<this.segments;i++)r=(r=n.scaled(i/this.segments)).addNoise(this.segmentJitter),e.strokeStyle=this.color,e.lineWidth=this.lineWidth,e.globalAlpha=this.radius/255,e.beginPath(),e.moveTo(this.x+a.x,this.y+a.y),e.lineTo(this.x+r.x,this.y+r.y),e.closePath(),e.stroke(),a=r;e.restore()},e.prototype.randomVec=function(){var e=this.radius+l(-this.radiusVariance,this.radiusVariance);e<0&&(e=0);var t=l(0,2*Math.PI),n=Math.cos(t)*e,a=Math.sin(t)*e;return new S(n,a)},e}(),S=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.normalized=function(){var t=this.length();return new e(this.x/t,this.y/t)},e.prototype.length=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.scaled=function(t){return new e(this.x*t,this.y*t)},e.prototype.addNoise=function(t){return new e(this.x+l(-t,t),this.y+l(-t,t))},e}(),w=function(){function e(e){this.x=e.x,this.y=e.y,this.radius=e.radius,this.dx=e.dx,this.dy=e.dy,this.canvasWidth=e.canvasWidth,this.canvasHeight=e.canvasHeight,this.color=e.color}return e.prototype.update=function(){(this.x+this.radius>this.canvasWidth||this.x-this.radius<0)&&(this.dx=-this.dx),(this.y+this.radius>this.canvasHeight||this.y-this.radius<0)&&(this.dy=-this.dy),this.x+=this.dx,this.y+=this.dy},e.prototype.draw=function(e){e.save(),e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore()},e}(),b=[],M=["rgba(144, 255, 70, 1)","rgba(255, 171, 81, 1)"],q=["rgba(58, 99, 166, 1)","rgba(88, 66, 184, 1)","rgba(40, 121, 91, 1)"],x=[],T={showGradient:!0,showBars:!0,showCircles:!0,showTeslas:!0,timeDomain:!1,coilCenter:.5},E=Object.freeze({sound1:"media/Blessing Song.mp3"}),P=function(e,a){document.querySelector("#fs-button").onclick=function(e){var t;console.log("goFullscreen() called"),(t=a).requestFullscreen?t.requestFullscreen():t.mozRequestFullscreen?t.mozRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()};var r=document.querySelector("#play-button");r.onclick=function(e){console.log("audioCtx.state before = ".concat(t.state)),"suspended"==t.state&&t.resume();var a=e.target;console.log("audioCtx.state after = ".concat(t.state)),"no"==a.dataset.playing?(n.play(),a.dataset.playing="yes"):(n.pause(),a.dataset.playing="no")};var c=document.querySelector("#volume-slider"),l=document.querySelector("#volume-label");c.oninput=function(e){var t=e.target;!function(e){var t=Number(e);i.gain.value=t}(t.value);var n=Number(t.value);l.innerHTML=String(Math.round(n/2*100))},c.dispatchEvent(new Event("input"));var u=document.querySelector("#distortion-slider"),h=document.querySelector("#distortion-label");u.oninput=function(e){var t=e.target;!function(e){var t=Number(e),n=g(t);o.curve=n}(t.value);var n=Number(t.value);h.innerHTML=String(Math.round(n))},u.dispatchEvent(new Event("input"));var d=document.querySelector("#pan-slider"),v=document.querySelector("#pan-label");d.oninput=function(e){var t,n,a=e.target;t=a.value,n=Number(t),s.pan.value=n,v.innerHTML=a.value},d.dispatchEvent(new Event("input"));var f=document.querySelector("#coil-slider"),y=document.querySelector("#coil-label");f.oninput=function(e){var t=e.target;T.coilCenter=Number(t.value),y.innerHTML=t.value},f.dispatchEvent(new Event("input")),document.querySelector("#track-select").onchange=function(e){var t=e.target;m(t.value),"yes"==r.dataset.playButton&&r.dispatchEvent(new MouseEvent("click"))};var p=document.querySelector("#gradient-cb"),S=document.querySelector("#bars-cb"),w=document.querySelector("#circles-cb"),b=document.querySelector("#tesla-cb"),M=document.querySelector("#domain-type-cb");p.checked=T.showGradient,S.checked=T.showBars,w.checked=T.showCircles,b.checked=T.showTeslas,M.checked=T.timeDomain,p.addEventListener("change",function(e){T.showGradient=!T.showGradient,p.checked=T.showGradient}),S.addEventListener("change",function(e){T.showBars=!T.showBars,S.checked=T.showBars}),w.addEventListener("change",function(e){T.showCircles=!T.showCircles,w.checked=T.showCircles}),b.addEventListener("change",function(e){T.showTeslas=!T.showTeslas,b.checked=T.showTeslas}),M.addEventListener("change",function(e){T.timeDomain=!T.timeDomain,M.checked=T.timeDomain})},N=function(){setTimeout(function(){N()},1e3/60),function(e){e.timeDomain?f.getByteTimeDomainData(y):f.getByteFrequencyData(y);var t=e.coilCenter;if(b[0].dataEnd=t,b[1].dataStart=t,u.save(),u.globalAlpha=.1,u.clearRect(0,0,d,v),u.restore(),h.fillStyle="#4b2386ff",h.fillRect(0,0,d,v),e.showGradient&&x.forEach(function(e){e.update(),e.draw(h)}),e.showBars){var n=(d-4*y.length-10)/y.length,a=5+t*y.length*(n+4)/2,r=d-(d-2*a)/2;b[0].updateX(a),b[1].updateX(r),u.save(),u.globalAlpha=.5,u.beginPath();var i=[];u.moveTo(5,v/2-y[0]/2);for(var o=0;o<y.length;o++){var s=5+o*(n+4),l=v/2-y[o]/2;if(i.push([s,v/2+y[o]/2]),o<y.length-1){var g=5+(o+1)*(n+4),m=v/2-y[o+1]/2;0===o&&u.lineTo(s,l);var p=(g+s)/2,S=(m+l)/2;u.quadraticCurveTo(s,l,p,S)}else u.lineTo(s,l)}for(o=i.length-1;o>0;o--)s=i[o][0],l=i[o][1],o<y.length-1?(g=i[o-1][0],m=i[o-1][1],0===o&&u.lineTo(s,l),p=(g+s)/2,S=(m+l)/2,u.quadraticCurveTo(s,l,p,S)):u.lineTo(s,l);u.closePath();var w=function(e,t,n,a,r,i){for(var o=e.createLinearGradient(0,0,a,0),s=0,c=i;s<c.length;s++){var l=c[s];o.addColorStop(l.percent,l.color)}return o}(u,0,0,d,0,[{percent:0,color:M[0]},{percent:+t-.05<.01?0:+t-.05,color:M[0]},{percent:+t+.05>.99?.99:+t+.05,color:M[1]},{percent:t,color:M[1]}]);u.fillStyle=w,u.fill(),u.restore()}if(e.showCircles){var q=v/4;u.save(),u.globalAlpha=.5,y.forEach(function(e,t){var n=e/255,a=n*q;u.beginPath(),u.fillStyle=c(58,99,166,.34-n/3),u.arc(d/2,v/2,a,0,2*Math.PI,!1),u.fill(),u.closePath(),u.beginPath(),u.fillStyle=c(88,66,184,.1-n/10),u.arc(d/2,v/2,1.5*a,0,2*Math.PI,!1),u.fill(),u.closePath(),u.save(),u.beginPath(),u.fillStyle=c(40,121,91,.5-n/5),u.arc(d/2,v/2,.5*a,0,2*Math.PI,!1),u.fill(),u.closePath(),u.restore()}),u.restore()}e.showTeslas&&b.forEach(function(e){e.update(y),e.draw(u)})}(T)};window.onload=function(){console.log("window.onload called"),function(){var c,S;c=E.sound1,S=window.AudioContext,t=new S,n=new Audio,m(c),a=t.createMediaElementSource(n),(r=t.createAnalyser()).fftSize=e.NUM_SAMPLES,(i=t.createGain()).gain.value=e.GAIN,(o=t.createWaveShaper()).curve=g(e.DISTORTION),o.oversample="4x",(s=t.createStereoPanner()).pan.value=e.PAN,a.connect(r).connect(s).connect(i).connect(o).connect(t.destination),console.log("init called"),fetch("data/av-data.json").then(function(e){return e.json()}).then(function(e){var t=document.querySelector("title"),n=document.querySelector("#title");t.innerHTML=e.title,n.innerHTML=e.title;var a=document.querySelector("#track-select"),r=e.audio_files.map(function(e){return'<option value="'.concat(e.filepath,'">').concat(e.metadata.title,"</option>")}).join("\n");a.innerHTML=r,document.querySelector("#instructions").innerHTML=e.instructions}).catch(function(e){return console.log("Warning, error occurred: ".concat(e)),null});var T=document.querySelector("#fg-canvas"),A=document.querySelector("#canvas");P(T,A),function(e,t){u=e.getContext("2d"),d=e.width,v=e.height,f=t,y=new Uint8Array(f.fftSize/2),h=document.querySelector("#bg-canvas").getContext("2d"),b.push(new p({x:200,y:200,color:M[0],radius:200,radiusVariance:100,arcs:10,segments:20,segmentJitter:5,lineWidth:1,dataStart:0,dataEnd:.5}),new p({x:600,y:200,color:M[1],radius:200,radiusVariance:100,arcs:10,segments:20,segmentJitter:5,lineWidth:1,dataStart:.5,dataEnd:1}));for(var n=0;n<20;n++){var a=l(d/15,d/5),r=l(a,d-a),i=l(a,v-a),o=l(-d/1e3,d/1e3),s=l(-v/1e3,v/1e3);x.push(new w({x:r,y:i,radius:a,dx:o,dy:s,canvasWidth:d,canvasHeight:v,color:q[Math.floor(Math.random()*q.length)]}))}}(T,r),N()}()}})();
//# sourceMappingURL=bundle.js.map