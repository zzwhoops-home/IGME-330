(()=>{"use strict";var e,t,n,a,r,i,o,s,c,l=function(e,t,n,a){return void 0===a&&(a=1),"rgba(".concat(e,",").concat(t,",").concat(n,",").concat(a,")")},u=function(e,t){return Math.random()*(t-e)+e};!function(e){e[e.GAIN=5]="GAIN",e[e.DISTORTION=0]="DISTORTION",e[e.PAN=0]="PAN",e[e.NUM_SAMPLES=256]="NUM_SAMPLES"}(e||(e={})),function(e){e.sound1="media/Blessing Song.mp3"}(t||(t={})),new Uint8Array(e.NUM_SAMPLES/2);var h,d,v,f,y,g,m=function(e){for(var t="number"==typeof e?e:50,n=44100,a=new Float32Array(n),r=Math.PI/180,i=0;i<n;i++){var o=2*i/n-1;a[i]=(3+t)*o*20*r/(Math.PI+t*Math.abs(o))}return a},p=function(e){a.src=e},S=function(){function e(e){this.x=e.x,this.y=e.y,this.color=e.color,this.radius=e.radius,this.radiusVariance=e.radiusVariance,this.arcs=e.arcs,this.segments=e.segments,this.segmentJitter=e.segmentJitter,this.lineWidth=e.lineWidth,this.dataStart=e.dataStart,this.dataEnd=e.dataEnd}return e.prototype.update=function(e){var t=e.length||0,n=Math.floor(this.dataStart*t),a=Math.round(this.dataEnd*t),r=e.slice(n,a).reduce(function(e,t){return e+t},0)/(a-n);this.radius=r,this.radiusVariance=r,this.arcs=Math.round(r/30),this.segmentJitter=8*(1.3-(this.dataEnd-this.dataStart))},e.prototype.updateX=function(e){this.x=e},e.prototype.draw=function(e){e.save();for(var t=1;t<=this.arcs;t++)for(var n=this.randomVec(),a=new w(0,0),r=new w(0,0),i=0;i<this.segments;i++)r=(r=n.scaled(i/this.segments)).addNoise(this.segmentJitter),e.strokeStyle=this.color,e.lineWidth=this.lineWidth,e.globalAlpha=this.radius/255,e.beginPath(),e.moveTo(this.x+a.x,this.y+a.y),e.lineTo(this.x+r.x,this.y+r.y),e.closePath(),e.stroke(),a=r;e.restore()},e.prototype.randomVec=function(){var e=this.radius+u(-this.radiusVariance,this.radiusVariance);e<0&&(e=0);var t=u(0,2*Math.PI),n=Math.cos(t)*e,a=Math.sin(t)*e;return new w(n,a)},e}(),w=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.normalized=function(){var t=this.length();return new e(this.x/t,this.y/t)},e.prototype.length=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.scaled=function(t){return new e(this.x*t,this.y*t)},e.prototype.addNoise=function(t){return new e(this.x+u(-t,t),this.y+u(-t,t))},e}(),b=function(){function e(e){this.x=e.x,this.y=e.y,this.radius=e.radius,this.dx=e.dx,this.dy=e.dy,this.canvasWidth=e.canvasWidth,this.canvasHeight=e.canvasHeight,this.color=e.color}return e.prototype.update=function(){(this.x+this.radius>this.canvasWidth||this.x-this.radius<0)&&(this.dx=-this.dx),(this.y+this.radius>this.canvasHeight||this.y-this.radius<0)&&(this.dy=-this.dy),this.x+=this.dx,this.y+=this.dy},e.prototype.draw=function(e){e.save(),e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore()},e}(),M=[],q=["rgba(144, 255, 70, 1)","rgba(255, 171, 81, 1)"],x=["rgba(58, 99, 166, 1)","rgba(88, 66, 184, 1)","rgba(40, 121, 91, 1)"],T=[],E={showGradient:!0,showBars:!0,showCircles:!0,showTeslas:!0,timeDomain:!1,coilCenter:.5},P=function(e,t){document.querySelector("#fs-button").onclick=function(e){var n;console.log("goFullscreen() called"),(n=t).requestFullscreen?n.requestFullscreen():n.mozRequestFullscreen?n.mozRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()};var r=document.querySelector("#play-button");r.onclick=function(e){console.log("audioCtx.state before = ".concat(n.state)),"suspended"==n.state&&n.resume();var t=e.target;console.log("audioCtx.state after = ".concat(n.state)),"no"==t.dataset.playing?(a.play(),t.dataset.playing="yes"):(a.pause(),t.dataset.playing="no")};var i=document.querySelector("#volume-slider"),l=document.querySelector("#volume-label");i.oninput=function(e){var t=e.target;!function(e){var t=Number(e);o.gain.value=t}(t.value);var n=Number(t.value);l.innerHTML=String(Math.round(n/2*100))},i.dispatchEvent(new Event("input"));var u=document.querySelector("#distortion-slider"),h=document.querySelector("#distortion-label");u.oninput=function(e){var t=e.target;!function(e){var t=Number(e),n=m(t);s.curve=n}(t.value);var n=Number(t.value);h.innerHTML=String(Math.round(n))},u.dispatchEvent(new Event("input"));var d=document.querySelector("#pan-slider"),v=document.querySelector("#pan-label");d.oninput=function(e){var t,n,a=e.target;t=a.value,n=Number(t),c.pan.value=n,v.innerHTML=a.value},d.dispatchEvent(new Event("input"));var f=document.querySelector("#coil-slider"),y=document.querySelector("#coil-label");f.oninput=function(e){var t=e.target;E.coilCenter=Number(t.value),y.innerHTML=t.value},f.dispatchEvent(new Event("input")),document.querySelector("#track-select").onchange=function(e){var t=e.target;p(t.value),"yes"==r.dataset.playButton&&r.dispatchEvent(new MouseEvent("click"))};var g=document.querySelector("#gradient-cb"),S=document.querySelector("#bars-cb"),w=document.querySelector("#circles-cb"),b=document.querySelector("#tesla-cb"),M=document.querySelector("#domain-type-cb");g.checked=E.showGradient,S.checked=E.showBars,w.checked=E.showCircles,b.checked=E.showTeslas,M.checked=E.timeDomain,g.addEventListener("change",function(e){E.showGradient=!E.showGradient,g.checked=E.showGradient}),S.addEventListener("change",function(e){E.showBars=!E.showBars,S.checked=E.showBars}),w.addEventListener("change",function(e){E.showCircles=!E.showCircles,w.checked=E.showCircles}),b.addEventListener("change",function(e){E.showTeslas=!E.showTeslas,b.checked=E.showTeslas}),M.addEventListener("change",function(e){E.timeDomain=!E.timeDomain,M.checked=E.timeDomain})},N=function(){setTimeout(function(){N()},1e3/60),function(e){e.timeDomain?y.getByteTimeDomainData(g):y.getByteFrequencyData(g);var t=e.coilCenter;if(M[0].dataEnd=t,M[1].dataStart=t,h.save(),h.globalAlpha=.1,h.clearRect(0,0,v,f),h.restore(),d.fillStyle="#4b2386ff",d.fillRect(0,0,v,f),e.showGradient&&T.forEach(function(e){e.update(),e.draw(d)}),e.showBars){var n=(v-4*g.length-10)/g.length,a=5+t*g.length*(n+4)/2,r=v-(v-2*a)/2;M[0].updateX(a),M[1].updateX(r),h.save(),h.globalAlpha=.5,h.beginPath();var i=[];h.moveTo(5,f/2-g[0]/2);for(var o=0;o<g.length;o++){var s=5+o*(n+4),c=f/2-g[o]/2;if(i.push([s,f/2+g[o]/2]),o<g.length-1){var u=5+(o+1)*(n+4),m=f/2-g[o+1]/2;0===o&&h.lineTo(s,c);var p=(u+s)/2,S=(m+c)/2;h.quadraticCurveTo(s,c,p,S)}else h.lineTo(s,c)}for(o=i.length-1;o>0;o--)s=i[o][0],c=i[o][1],o<g.length-1?(u=i[o-1][0],m=i[o-1][1],0===o&&h.lineTo(s,c),p=(u+s)/2,S=(m+c)/2,h.quadraticCurveTo(s,c,p,S)):h.lineTo(s,c);h.closePath();var w=function(e,t,n,a,r,i){for(var o=e.createLinearGradient(0,0,a,0),s=0,c=i;s<c.length;s++){var l=c[s];o.addColorStop(l.percent,l.color)}return o}(h,0,0,v,0,[{percent:0,color:q[0]},{percent:+t-.05<.01?0:+t-.05,color:q[0]},{percent:+t+.05>.99?.99:+t+.05,color:q[1]},{percent:t,color:q[1]}]);h.fillStyle=w,h.fill(),h.restore()}if(e.showCircles){var b=f/4;h.save(),h.globalAlpha=.5,g.forEach(function(e,t){var n=e/255,a=n*b;h.beginPath(),h.fillStyle=l(58,99,166,.34-n/3),h.arc(v/2,f/2,a,0,2*Math.PI,!1),h.fill(),h.closePath(),h.beginPath(),h.fillStyle=l(88,66,184,.1-n/10),h.arc(v/2,f/2,1.5*a,0,2*Math.PI,!1),h.fill(),h.closePath(),h.save(),h.beginPath(),h.fillStyle=l(40,121,91,.5-n/5),h.arc(v/2,f/2,.5*a,0,2*Math.PI,!1),h.fill(),h.closePath(),h.restore()}),h.restore()}e.showTeslas&&M.forEach(function(e){e.update(g),e.draw(h)})}(E)};window.onload=function(){console.log("window.onload called"),function(){var l,w;l=t.sound1,w=window.AudioContext,n=new w,a=new Audio,p(l),r=n.createMediaElementSource(a),(i=n.createAnalyser()).fftSize=e.NUM_SAMPLES,(o=n.createGain()).gain.value=e.GAIN,(s=n.createWaveShaper()).curve=m(e.DISTORTION),s.oversample="4x",(c=n.createStereoPanner()).pan.value=e.PAN,r.connect(i).connect(c).connect(o).connect(s).connect(n.destination),console.log("init called"),fetch("data/av-data.json").then(function(e){return e.json()}).then(function(e){var t=document.querySelector("title"),n=document.querySelector("#title");t.innerHTML=e.title,n.innerHTML=e.title;var a=document.querySelector("#track-select"),r=e.audio_files.map(function(e){return'<option value="'.concat(e.filepath,'">').concat(e.metadata.title,"</option>")}).join("\n");a.innerHTML=r,document.querySelector("#instructions").innerHTML=e.instructions}).catch(function(e){return console.log("Warning, error occurred: ".concat(e)),null});var E=document.querySelector("#fg-canvas"),A=document.querySelector("#canvas");P(E,A),function(e,t){h=e.getContext("2d"),v=e.width,f=e.height,y=t,g=new Uint8Array(y.fftSize/2),d=document.querySelector("#bg-canvas").getContext("2d"),M.push(new S({x:200,y:200,color:q[0],radius:200,radiusVariance:100,arcs:10,segments:20,segmentJitter:5,lineWidth:1,dataStart:0,dataEnd:.5}),new S({x:600,y:200,color:q[1],radius:200,radiusVariance:100,arcs:10,segments:20,segmentJitter:5,lineWidth:1,dataStart:.5,dataEnd:1}));for(var n=0;n<20;n++){var a=u(v/15,v/5),r=u(a,v-a),i=u(a,f-a),o=u(-v/1e3,v/1e3),s=u(-f/1e3,f/1e3);T.push(new b({x:r,y:i,radius:a,dx:o,dy:s,canvasWidth:v,canvasHeight:f,color:x[Math.floor(Math.random()*x.length)]}))}}(E,i),N()}()}})();
//# sourceMappingURL=bundle.js.map