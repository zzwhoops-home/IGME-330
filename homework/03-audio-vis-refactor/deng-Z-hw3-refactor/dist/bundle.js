(()=>{"use strict";var e,t,n,a,r,o,i,c,s,l=function(e,t,n,a){return void 0===a&&(a=1),"rgba(".concat(e,",").concat(t,",").concat(n,",").concat(a,")")},u=function(e,t){return Math.random()*(t-e)+e};!function(e){e[e.GAIN=5]="GAIN",e[e.DISTORTION=0]="DISTORTION",e[e.PAN=0]="PAN",e[e.NUM_SAMPLES=256]="NUM_SAMPLES"}(e||(e={})),function(e){e.sound1="media/Blessing Song.mp3"}(t||(t={})),new Uint8Array(e.NUM_SAMPLES/2);var d,h,v,f,g,y,p=function(e){for(var t="number"==typeof e?e:50,n=44100,a=new Float32Array(n),r=Math.PI/180,o=0;o<n;o++){var i=2*o/n-1;a[o]=(3+t)*i*20*r/(Math.PI+t*Math.abs(i))}return a},m=function(e){a.src=e},S=function(){function e(e){var t=e.x,n=e.y,a=e.color,r=e.radius,o=e.radiusVariance,i=e.arcs,c=e.segments,s=e.segmentJitter,l=e.lineWidth,u=e.dataStart,d=e.dataEnd;Object.assign(this,{x:t,y:n,color:a,radius:r,radiusVariance:o,arcs:i,segments:c,segmentJitter:s,lineWidth:l,dataStart:u,dataEnd:d})}return e.prototype.update=function(e){var t=e.length||0,n=Math.floor(this.dataStart*t),a=Math.round(this.dataEnd*t),r=e.slice(n,a).reduce(function(e,t){return e+t},0)/(a-n);this.radius=r,this.radiusVariance=r,this.arcs=Math.round(r/30),this.segmentJitter=8*(1.3-(this.dataEnd-this.dataStart))},e.prototype.updateX=function(e){this.x=e},e.prototype.draw=function(e){e.save();for(var t=1;t<=this.arcs;t++)for(var n=this.randomVec(),a=new w(0,0),r=new w(0,0),o=0;o<this.segments;o++)r=(r=n.scaled(o/this.segments)).addNoise(this.segmentJitter),e.strokeStyle=this.color,e.lineWidth=this.lineWidth,e.globalAlpha=this.radius/255,e.beginPath(),e.moveTo(this.x+a.x,this.y+a.y),e.lineTo(this.x+r.x,this.y+r.y),e.closePath(),e.stroke(),a=r;e.restore()},e.prototype.randomVec=function(){var e=this.radius+u(-this.radiusVariance,this.radiusVariance);e<0&&(e=0);var t=u(0,2*Math.PI),n=Math.cos(t)*e,a=Math.sin(t)*e;return new w(n,a)},e}(),w=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.normalized=function(){var t=this.length();return new e(this.x/t,this.y/t)},e.prototype.length=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.scaled=function(t){return new e(this.x*t,this.y*t)},e.prototype.addNoise=function(t){return new e(this.x+u(-t,t),this.y+u(-t,t))},e}(),b=function(){function e(e){var t=e.x,n=e.y,a=e.radius,r=e.dx,o=e.dy,i=e.canvasWidth,c=e.canvasHeight,s=e.color;Object.assign(this,{x:t,y:n,radius:a,dx:r,dy:o,canvasWidth:i,canvasHeight:c,color:s})}return e.prototype.update=function(){(this.x+this.radius>this.canvasWidth||this.x-this.radius<0)&&(this.dx=-this.dx),(this.y+this.radius>this.canvasHeight||this.y-this.radius<0)&&(this.dy=-this.dy),this.x+=this.dx,this.y+=this.dy},e.prototype.draw=function(e){e.save(),e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore()},e}(),M=[],x=["rgba(144, 255, 70, 1)","rgba(255, 171, 81, 1)"],T=["rgba(58, 99, 166, 1)","rgba(88, 66, 184, 1)","rgba(40, 121, 91, 1)"],E=[],q={showGradient:!0,showBars:!0,showCircles:!0,showTeslas:!0,timeDomain:!1,coilCenter:.5},P=function(e,t){document.querySelector("#fs-button").onclick=function(e){var n;console.log("goFullscreen() called"),(n=t).requestFullscreen&&n.requestFullscreen()};var r=document.querySelector("#play-button");r.onclick=function(e){console.log("audioCtx.state before = ".concat(n.state)),"suspended"==n.state&&n.resume();var t=e.target;console.log("audioCtx.state after = ".concat(n.state)),"no"==t.dataset.playing?(a.play(),t.dataset.playing="yes"):(a.pause(),t.dataset.playing="no")};var o=document.querySelector("#volume-slider"),l=document.querySelector("#volume-label");o.oninput=function(e){var t=e.target;!function(e){var t=Number(e);i.gain.value=t}(t.value);var n=Number(t.value);l.innerHTML=String(Math.round(n/2*100))},o.dispatchEvent(new Event("input"));var u=document.querySelector("#distortion-slider"),d=document.querySelector("#distortion-label");u.oninput=function(e){var t=e.target;!function(e){var t=Number(e),n=p(t);c.curve=n}(t.value);var n=Number(t.value);d.innerHTML=String(Math.round(n))},u.dispatchEvent(new Event("input"));var h=document.querySelector("#pan-slider"),v=document.querySelector("#pan-label");h.oninput=function(e){var t,n,a=e.target;t=a.value,n=Number(t),s.pan.value=n,v.innerHTML=a.value},h.dispatchEvent(new Event("input"));var f=document.querySelector("#coil-slider"),g=document.querySelector("#coil-label");f.oninput=function(e){var t=e.target;q.coilCenter=Number(t.value),g.innerHTML=t.value},f.dispatchEvent(new Event("input")),document.querySelector("#track-select").onchange=function(e){var t=e.target;m(t.value),"yes"==r.dataset.playButton&&r.dispatchEvent(new MouseEvent("click"))};var y=document.querySelector("#gradient-cb"),S=document.querySelector("#bars-cb"),w=document.querySelector("#circles-cb"),b=document.querySelector("#tesla-cb"),M=document.querySelector("#domain-type-cb");y.checked=q.showGradient,S.checked=q.showBars,w.checked=q.showCircles,b.checked=q.showTeslas,M.checked=q.timeDomain,y.addEventListener("change",function(e){q.showGradient=!q.showGradient,y.checked=q.showGradient}),S.addEventListener("change",function(e){q.showBars=!q.showBars,S.checked=q.showBars}),w.addEventListener("change",function(e){q.showCircles=!q.showCircles,w.checked=q.showCircles}),b.addEventListener("change",function(e){q.showTeslas=!q.showTeslas,b.checked=q.showTeslas}),M.addEventListener("change",function(e){q.timeDomain=!q.timeDomain,M.checked=q.timeDomain})},N=function(){setTimeout(function(){N()},1e3/60),function(e){e.timeDomain?g.getByteTimeDomainData(y):g.getByteFrequencyData(y);var t=e.coilCenter;if(M[0].dataEnd=t,M[1].dataStart=t,d.save(),d.globalAlpha=.1,d.clearRect(0,0,v,f),d.restore(),h.fillStyle="#4b2386ff",h.fillRect(0,0,v,f),e.showGradient&&E.forEach(function(e){e.update(),e.draw(h)}),e.showBars){var n=(v-4*y.length-10)/y.length,a=5+t*y.length*(n+4)/2,r=v-(v-2*a)/2;M[0].updateX(a),M[1].updateX(r),d.save(),d.globalAlpha=.5,d.beginPath();var o=[];d.moveTo(5,f/2-y[0]/2);for(var i=0;i<y.length;i++){var c=5+i*(n+4),s=f/2-y[i]/2;if(o.push([c,f/2+y[i]/2]),i<y.length-1){var u=5+(i+1)*(n+4),p=f/2-y[i+1]/2;0===i&&d.lineTo(c,s);var m=(u+c)/2,S=(p+s)/2;d.quadraticCurveTo(c,s,m,S)}else d.lineTo(c,s)}for(i=o.length-1;i>0;i--)c=o[i][0],s=o[i][1],i<y.length-1?(u=o[i-1][0],p=o[i-1][1],0===i&&d.lineTo(c,s),m=(u+c)/2,S=(p+s)/2,d.quadraticCurveTo(c,s,m,S)):d.lineTo(c,s);d.closePath();var w=function(e,t,n,a,r,o){for(var i=e.createLinearGradient(0,0,a,0),c=0,s=o;c<s.length;c++){var l=s[c];i.addColorStop(l.percent,l.color)}return i}(d,0,0,v,0,[{percent:0,color:x[0]},{percent:+t-.05<.01?0:+t-.05,color:x[0]},{percent:+t+.05>.99?.99:+t+.05,color:x[1]},{percent:t,color:x[1]}]);d.fillStyle=w,d.fill(),d.restore()}if(e.showCircles){var b=f/4;d.save(),d.globalAlpha=.5,y.forEach(function(e,t){var n=e/255,a=n*b;d.beginPath(),d.fillStyle=l(58,99,166,.34-n/3),d.arc(v/2,f/2,a,0,2*Math.PI,!1),d.fill(),d.closePath(),d.beginPath(),d.fillStyle=l(88,66,184,.1-n/10),d.arc(v/2,f/2,1.5*a,0,2*Math.PI,!1),d.fill(),d.closePath(),d.save(),d.beginPath(),d.fillStyle=l(40,121,91,.5-n/5),d.arc(v/2,f/2,.5*a,0,2*Math.PI,!1),d.fill(),d.closePath(),d.restore()}),d.restore()}e.showTeslas&&M.forEach(function(e){e.update(y),e.draw(d)})}(q)};window.onload=function(){console.log("window.onload called"),function(){var l,w;l=t.sound1,w=window.AudioContext,n=new w,a=new Audio,m(l),r=n.createMediaElementSource(a),(o=n.createAnalyser()).fftSize=e.NUM_SAMPLES,(i=n.createGain()).gain.value=e.GAIN,(c=n.createWaveShaper()).curve=p(e.DISTORTION),c.oversample="4x",(s=n.createStereoPanner()).pan.value=e.PAN,r.connect(o).connect(s).connect(i).connect(c).connect(n.destination),console.log("init called"),fetch("data/av-data.json").then(function(e){return e.json()}).then(function(e){var t=document.querySelector("title"),n=document.querySelector("#title");t.innerHTML=e.title,n.innerHTML=e.title;var a=document.querySelector("#track-select"),r=e.audio_files.map(function(e){return'<option value="'.concat(e.filepath,'">').concat(e.metadata.title,"</option>")}).join("\n");a.innerHTML=r,document.querySelector("#instructions").innerHTML=e.instructions}).catch(function(e){return console.log("Warning, error occurred: ".concat(e)),null});var q=document.querySelector("#fg-canvas"),A=document.querySelector("#canvas");P(q,A),function(e,t){d=e.getContext("2d"),v=e.width,f=e.height,g=t,y=new Uint8Array(g.fftSize/2),h=document.querySelector("#bg-canvas").getContext("2d"),M.push(new S({x:200,y:200,color:x[0],radius:200,radiusVariance:100,arcs:10,segments:20,segmentJitter:5,lineWidth:1,dataStart:0,dataEnd:.5}),new S({x:600,y:200,color:x[1],radius:200,radiusVariance:100,arcs:10,segments:20,segmentJitter:5,lineWidth:1,dataStart:.5,dataEnd:1}));for(var n=0;n<20;n++){var a=u(v/15,v/5),r=u(a,v-a),o=u(a,f-a),i=u(-v/1e3,v/1e3),c=u(-f/1e3,f/1e3);E.push(new b({x:r,y:o,radius:a,dx:i,dy:c,canvasWidth:v,canvasHeight:f,color:T[Math.floor(Math.random()*T.length)]}))}}(q,o),N()}()}})();
//# sourceMappingURL=bundle.js.map