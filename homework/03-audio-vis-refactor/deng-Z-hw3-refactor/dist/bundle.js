(()=>{"use strict";var e,t,n,a,r,i,o,s,c,l,u,h,d,v=function(e,t,n,a){return void 0===a&&(a=1),"rgba(".concat(e,",").concat(t,",").concat(n,",").concat(a,")")},f=function(e,t){return Math.random()*(t-e)+e},m=Object.freeze({gain:5,distortion:0,pan:0,numSamples:256}),g=(new Uint8Array(m.numSamples/2),function(e){for(var t="number"==typeof e?e:50,n=44100,a=new Float32Array(n),r=Math.PI/180,i=0;i<n;i++){var o=2*i/n-1;a[i]=(3+t)*o*20*r/(Math.PI+t*Math.abs(o))}return a}),y=function(e){t.src=e},p=function(){function e(e){this.x=e.x,this.y=e.y,this.color=e.color,this.radius=e.radius,this.radiusVariance=e.radiusVariance,this.arcs=e.arcs,this.segments=e.segments,this.segmentJitter=e.segmentJitter,this.lineWidth=e.lineWidth,this.dataStart=e.dataStart,this.dataEnd=e.dataEnd}return e.prototype.update=function(e){var t=e.length||0,n=Math.floor(this.dataStart*t),a=Math.round(this.dataEnd*t),r=e.slice(n,a).reduce(function(e,t){return e+t},0)/(a-n);this.radius=r,this.radiusVariance=r,this.arcs=Math.round(r/30),this.segmentJitter=8*(1.3-(this.dataEnd-this.dataStart))},e.prototype.updateX=function(e){this.x=e},e.prototype.draw=function(e){e.save();for(var t=1;t<=this.arcs;t++)for(var n=this.randomVec(),a=new w(0,0),r=new w(0,0),i=0;i<this.segments;i++)r=(r=n.scaled(i/this.segments)).addNoise(this.segmentJitter),e.strokeStyle=this.color,e.lineWidth=this.lineWidth,e.globalAlpha=this.radius/255,e.beginPath(),e.moveTo(this.x+a.x,this.y+a.y),e.lineTo(this.x+r.x,this.y+r.y),e.closePath(),e.stroke(),a=r;e.restore()},e.prototype.randomVec=function(){var e=this.radius+f(-this.radiusVariance,this.radiusVariance);e<0&&(e=0);var t=f(0,2*Math.PI),n=Math.cos(t)*e,a=Math.sin(t)*e;return new w(n,a)},e}(),w=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.normalized=function(){var t=this.length();return new e(this.x/t,this.y/t)},e.prototype.length=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.scaled=function(t){return new e(this.x*t,this.y*t)},e.prototype.addNoise=function(t){return new e(this.x+f(-t,t),this.y+f(-t,t))},e}(),S=function(){function e(e){this.x=e.x,this.y=e.y,this.radius=e.radius,this.dx=e.dx,this.dy=e.dy,this.canvasWidth=e.canvasWidth,this.canvasHeight=e.canvasHeight,this.color=e.color}return e.prototype.update=function(){(this.x+this.radius>this.canvasWidth||this.x-this.radius<0)&&(this.dx=-this.dx),(this.y+this.radius>this.canvasHeight||this.y-this.radius<0)&&(this.dy=-this.dy),this.x+=this.dx,this.y+=this.dy},e.prototype.draw=function(e){e.save(),e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore()},e}(),b=[],q=["rgba(144, 255, 70, 1)","rgba(255, 171, 81, 1)"],x=["rgba(58, 99, 166, 1)","rgba(88, 66, 184, 1)","rgba(40, 121, 91, 1)"],M=[],E={showGradient:!0,showBars:!0,showCircles:!0,showTeslas:!0,timeDomain:!1,coilCenter:.5},T=Object.freeze({sound1:"media/Blessing Song.mp3"}),P=function(n,a){document.querySelector("#fs-button").onclick=function(e){var t;console.log("goFullscreen() called"),(t=a).requestFullscreen?t.requestFullscreen():t.mozRequestFullscreen?t.mozRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()};var s=document.querySelector("#play-button");s.onclick=function(n){console.log("audioCtx.state before = ".concat(e.state)),"suspended"==e.state&&e.resume();var a=n.target;console.log("audioCtx.state after = ".concat(e.state)),"no"==a.dataset.playing?(t.play(),a.dataset.playing="yes"):(t.pause(),a.dataset.playing="no")};var c=document.querySelector("#volume-slider"),l=document.querySelector("#volume-label");c.oninput=function(e){var t=e.target;!function(e){var t=Number(e);r.gain.value=t}(t.value);var n=Number(t.value);l.innerHTML=String(Math.round(n/2*100))},c.dispatchEvent(new Event("input"));var u=document.querySelector("#distortion-slider"),h=document.querySelector("#distortion-label");u.oninput=function(e){var t=e.target;!function(e){var t=Number(e),n=g(t);i.curve=n}(t.value);var n=Number(t.value);h.innerHTML=String(Math.round(n))},u.dispatchEvent(new Event("input"));var d=document.querySelector("#pan-slider"),v=document.querySelector("#pan-label");d.oninput=function(e){var t,n,a=e.target;t=a.value,n=Number(t),o.pan.value=n,v.innerHTML=a.value},d.dispatchEvent(new Event("input"));var f=document.querySelector("#coil-slider"),m=document.querySelector("#coil-label");f.oninput=function(e){var t=e.target;E.coilCenter=Number(t.value),m.innerHTML=t.value},f.dispatchEvent(new Event("input")),document.querySelector("#track-select").onchange=function(e){var t=e.target;y(t.value),"yes"==s.dataset.playButton&&s.dispatchEvent(new MouseEvent("click"))};var p=document.querySelector("#gradient-cb"),w=document.querySelector("#bars-cb"),S=document.querySelector("#circles-cb"),b=document.querySelector("#tesla-cb"),q=document.querySelector("#domain-type-cb");p.checked=E.showGradient,w.checked=E.showBars,S.checked=E.showCircles,b.checked=E.showTeslas,q.checked=E.timeDomain,p.addEventListener("change",function(e){E.showGradient=!E.showGradient,p.checked=E.showGradient}),w.addEventListener("change",function(e){E.showBars=!E.showBars,w.checked=E.showBars}),S.addEventListener("change",function(e){E.showCircles=!E.showCircles,S.checked=E.showCircles}),b.addEventListener("change",function(e){E.showTeslas=!E.showTeslas,b.checked=E.showTeslas}),q.addEventListener("change",function(e){E.timeDomain=!E.timeDomain,q.checked=E.timeDomain})},k=function(){setTimeout(function(){k()},1e3/60),function(e){e.timeDomain?h.getByteTimeDomainData(d):h.getByteFrequencyData(d);var t=e.coilCenter;if(b[0].dataEnd=t,b[1].dataStart=t,s.save(),s.globalAlpha=.1,s.clearRect(0,0,l,u),s.restore(),c.fillStyle="#4b2386ff",c.fillRect(0,0,l,u),e.showGradient&&M.forEach(function(e){e.update(),e.draw(c)}),e.showBars){var n=(l-4*d.length-10)/d.length,a=5+t*d.length*(n+4)/2,r=l-(l-2*a)/2;b[0].updateX(a),b[1].updateX(r),s.save(),s.globalAlpha=.5,s.beginPath();var i=[];s.moveTo(5,u/2-d[0]/2);for(var o=0;o<d.length;o++){var f=5+o*(n+4),m=u/2-d[o]/2;if(i.push([f,u/2+d[o]/2]),o<d.length-1){var g=5+(o+1)*(n+4),y=u/2-d[o+1]/2;0===o&&s.lineTo(f,m);var p=(g+f)/2,w=(y+m)/2;s.quadraticCurveTo(f,m,p,w)}else s.lineTo(f,m)}for(o=i.length-1;o>0;o--)f=i[o][0],m=i[o][1],o<d.length-1?(g=i[o-1][0],y=i[o-1][1],0===o&&s.lineTo(f,m),p=(g+f)/2,w=(y+m)/2,s.quadraticCurveTo(f,m,p,w)):s.lineTo(f,m);s.closePath();var S=function(e,t,n,a,r,i){for(var o=e.createLinearGradient(0,0,a,0),s=0,c=i;s<c.length;s++){var l=c[s];o.addColorStop(l.percent,l.color)}return o}(s,0,0,l,0,[{percent:0,color:q[0]},{percent:+t-.05<.01?0:+t-.05,color:q[0]},{percent:+t+.05>.99?.99:+t+.05,color:q[1]},{percent:t,color:q[1]}]);s.fillStyle=S,s.fill(),s.restore()}if(e.showCircles){var x=u/4;s.save(),s.globalAlpha=.5,d.forEach(function(e,t){var n=e/255,a=n*x;s.beginPath(),s.fillStyle=v(58,99,166,.34-n/3),s.arc(l/2,u/2,a,0,2*Math.PI,!1),s.fill(),s.closePath(),s.beginPath(),s.fillStyle=v(88,66,184,.1-n/10),s.arc(l/2,u/2,1.5*a,0,2*Math.PI,!1),s.fill(),s.closePath(),s.save(),s.beginPath(),s.fillStyle=v(40,121,91,.5-n/5),s.arc(l/2,u/2,.5*a,0,2*Math.PI,!1),s.fill(),s.closePath(),s.restore()}),s.restore()}e.showTeslas&&b.forEach(function(e){e.update(d),e.draw(s)})}(E)};window.onload=function(){console.log("window.onload called"),function(){var v,w;v=T.sound1,w=window.AudioContext,e=new w,t=new Audio,y(v),n=e.createMediaElementSource(t),(a=e.createAnalyser()).fftSize=m.numSamples,(r=e.createGain()).gain.value=m.gain,(i=e.createWaveShaper()).curve=g(m.distortion),i.oversample="4x",(o=e.createStereoPanner()).pan.value=m.pan,n.connect(a).connect(o).connect(r).connect(i).connect(e.destination),console.log("init called"),fetch("data/av-data.json").then(function(e){return e.json()}).then(function(e){var t=document.querySelector("title"),n=document.querySelector("#title");t.innerHTML=e.title,n.innerHTML=e.title;var a=document.querySelector("#track-select"),r=e.audio_files.map(function(e){return'<option value="'.concat(e.filepath,'">').concat(e.metadata.title,"</option>")}).join("\n");a.innerHTML=r,document.querySelector("#instructions").innerHTML=e.instructions}).catch(function(e){return console.log("Warning, error occurred: ".concat(e)),null});var E=document.querySelector("#fg-canvas"),C=document.querySelector("#canvas");P(E,C),function(e,t){s=e.getContext("2d"),l=e.width,u=e.height,h=t,d=new Uint8Array(h.fftSize/2),c=document.querySelector("#bg-canvas").getContext("2d"),b.push(new p({x:200,y:200,color:q[0],radius:200,radiusVariance:100,arcs:10,segments:20,segmentJitter:5,lineWidth:1,dataStart:0,dataEnd:.5}),new p({x:600,y:200,color:q[1],radius:200,radiusVariance:100,arcs:10,segments:20,segmentJitter:5,lineWidth:1,dataStart:.5,dataEnd:1}));for(var n=0;n<20;n++){var a=f(l/15,l/5),r=f(a,l-a),i=f(a,u-a),o=f(-l/1e3,l/1e3),v=f(-u/1e3,u/1e3);M.push(new S({x:r,y:i,radius:a,dx:o,dy:v,canvasWidth:l,canvasHeight:u,color:x[Math.floor(Math.random()*x.length)]}))}}(E,a),k()}()}})();
//# sourceMappingURL=bundle.js.map